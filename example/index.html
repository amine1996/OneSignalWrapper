<html>

<head>
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.slim.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.slim.js.map"></script>

  <title>Projet Polytech</title>
</head>

<body>

  <p>Test notifs</p>

  <!-- Form notif all -->
  <form id="all">
    <input type="text" name="notifTextAll">
    <input type="button" value="send Notification to everyone" onclick="sendNotifAll() ">
  </form>

  <!-- Form notif ID -->
  <form id="id">
    <input type="text" name="notifTextId">
    <input type="button" value="send Notification to one or multiple IDs (separated by ;)" onclick="sendNotifId() ">
  </form>

  <!-- Form notif segment -->
  <form id="segment">
    <input type="text" name="notifTextSegment">
    <input type="button" value="send Notification to one or multiple segment (separated by ;)" onclick="sendNotifSegment() ">
  </form>

    <!-- Form notif saved -->
  <form id="saved">
    <input type="button" value="send notif to all users who connected since server runtime." onclick="sendNotifSaved() ">
  </form>

  <script>
    var socket = io.connect();

    var OneSignal = window.OneSignal || [];

    //Prompt user
    OneSignal.push(function () {
      OneSignal.init({
        appId: "cf2215e3-c4b4-4a45-bad9-0b42b8ada48e"
      });
    });

    //Send player ID after new subscription
    OneSignal.push(function () {
      OneSignal.on('subscriptionChange', function (isSubscribed) {
        OneSignal.getUserId(function (userId) {
          socket.emit("newUserId", userId);
          document.getElementById("advice").innerHTML = "";
          console.log("User accepted push notifications");
        });
      });
    });

    //Check for user push notif state and display informative text
    OneSignal.push(function () {
      if (!OneSignal.isPushNotificationsSupported()) {
        document.getElementById("error").innerHTML = "<p color='red'>Your device does not support web push notifications</p>";
        console.log("Push notifs not supported");
      }
      else {
        OneSignal.isPushNotificationsEnabled().then(function (enabled) {
          if (!enabled) {
            document.getElementById("advice").innerHTML = "Please enable push notifications for a better user experience";
            console.log("Push notifs not enabled");
          }
          else {
            console.log("Has push notifs enabled");
            OneSignal.push(function () {
              OneSignal.getUserId(function (userId) {
                socket.emit("userId", userId);
              });
            });

          }
        });
      }
    });

    //Send a notifications to all users
    function sendNotifAll() {
      socket.emit("sendNotifAll", document.getElementsByName("notifTextAll")[0].value);
    }

    function sendNotifId() {
      socket.emit("sendNotifId", document.getElementsByName("notifTextId")[0].value);
    }

    function sendNotifSegment() {
      socket.emit("sendNotifSegment", document.getElementsByName("notifTextSegment")[0].value);
    }

    function sendNotifSaved() {
      socket.emit("sendNotifSaved");
    }

  </script>

</body>

</html>